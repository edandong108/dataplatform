# 数据平台权限管理系统 PRD（产品需求文档）

## 📋 产品概述

### 产品名称
统一数据开发平台 - 权限管理系统

### 产品版本
v2.0 - 双权限体系版本

### 产品定位
为数据平台提供完整的双权限体系管理，实现平台级权限与项目级权限的分离管理，支持精细化的权限控制和灵活的角色配置。

## 🎯 核心价值

### 业务价值
- **权限分离**: 清晰区分平台管理权限与项目业务权限
- **安全可控**: 多层级权限体系，确保数据安全访问
- **高效管理**: 简化权限配置流程，提升管理效率
- **灵活扩展**: 支持自定义角色和权限的灵活配置

### 技术价值
- **架构清晰**: 双权限体系架构，职责分离明确
- **易于维护**: 模块化设计，便于功能迭代和维护
- **用户友好**: 直观的树形权限配置界面

## 🏗️ 系统架构

### 双权限体系架构

```
┌─────────────────────────────────────────────────────────┐
│                   双权限体系架构                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────┐    ┌─────────────────────────────┐  │
│  │   平台级权限     │    │        项目级权限            │  │
│  │                │    │                             │  │
│  │ • 平台管理员     │    │ • 项目管理员                │  │
│  │ • 平台运维       │    │ • 项目开发者                │  │
│  │ • 平台审计       │    │ • 项目分析师                │  │
│  │ • 普通用户       │    │ • 项目观察者                │  │
│  │                │    │ • 自定义角色                │  │
│  └─────────────────┘    └─────────────────────────────┘  │
│           │                           │                  │
│           │                           │                  │
│  ┌─────────────────┐    ┌─────────────────────────────┐  │
│  │   用户管理       │    │      项目用户分配            │  │
│  │ (集成平台权限)   │    │    (项目权限分配)           │  │
│  └─────────────────┘    └─────────────────────────────┘  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 👥 用户角色定义

### 平台级角色（4个核心角色）

#### 🔴 平台管理员 (role_platform_admin)
- **职责**: 拥有所有平台管理权限，负责整个数据平台的运维和管理
- **权限范围**: 最高权限，包含所有功能模块
- **典型用户**: 系统管理员、CTO、数据平台负责人

#### 🟢 平台运维 (role_platform_ops)  
- **职责**: 负责平台的日常运维工作，包括系统监控、性能优化和故障处理
- **权限范围**: 运维相关权限，不含用户管理权限
- **典型用户**: 运维工程师、系统监控人员

#### 🔵 平台审计 (role_platform_audit)
- **职责**: 负责平台的审计工作，可查看所有日志和监控数据，但无修改权限
- **权限范围**: 只读权限，专注审计监控
- **典型用户**: 审计人员、合规专员、质量管理员

#### 🟡 普通用户 (role_platform_user) 【默认角色】
- **职责**: 基础平台用户，可查看平台基础信息和个人相关数据
- **权限范围**: 最基础权限，新用户默认分配
- **典型用户**: 一般员工、外部协作人员

### 项目级角色（6个角色）

#### 核心项目角色（4个，不可删除）

##### 👑 项目管理员 (role_project_manager)
- **职责**: 管理分配的项目和项目内用户及权限，负责项目数据资源的分配和监控
- **权限范围**: 项目内最高权限
- **典型用户**: 项目经理、业务负责人

##### ⚙️ 项目开发者 (role_project_developer)
- **职责**: 负责项目内数据开发，包括模型设计、ETL开发和数据处理
- **权限范围**: 开发权限，可配置数据连接
- **典型用户**: 数据工程师、ETL开发人员

##### 📈 项目分析师 (role_project_analyst)
- **职责**: 负责项目内业务数据分析，制作数据报表和看板，专注于业务洞察
- **权限范围**: 分析权限，侧重看板制作
- **典型用户**: 数据分析师、BI工程师

##### 👁️ 项目观察者 (role_project_viewer)
- **职责**: 只能查看项目相关数据和报表，无任何修改权限，适合外部协作人员
- **权限范围**: 只读权限，适合外部协作
- **典型用户**: 外部合作伙伴、临时访问人员

#### 示例自定义角色（2个，可删除）

##### 🔬 数据科学家 (role_custom_data_scientist)
- **职责**: 专注于高级数据分析和机器学习模型开发的专业角色
- **权限范围**: 高级分析权限
- **典型用户**: 算法工程师、AI研究员

##### 👔 业务用户 (role_custom_business_user)
- **职责**: 主要使用数据看板和报表的业务部门用户，权限受限
- **权限范围**: 业务查看权限
- **典型用户**: 业务部门员工、决策者

## 🚀 核心功能

### 1. 角色管理 (role_management.html)

#### 功能描述
管理系统中的所有角色，包括平台级和项目级角色，支持角色的创建、编辑、删除和权限配置。

#### 核心特性
- **🎨 树形权限分配**: 全新的菜单目录式权限配置界面
- **📊 角色类型区分**: 清晰的平台级/项目级角色标识
- **🔒 核心角色保护**: 8个核心角色不可删除，确保系统稳定
- **⚡ 批量权限操作**: 支持按功能模块快速分配权限

#### 权限分配界面设计

**新版树形权限分配界面包含6个功能模块：**

```
🏠 工作台 (2/3)                    [☑] 
  ├── ☑ 查看数据看板
  ├── ☑ 管理数据看板  
  └── ☐ 导出数据看板

💾 数据管理 (4/6)                  [◐]
  ├── ☑ 查看数据源
  ├── ☑ 管理数据源
  ├── ☑ 配置数据连接
  ├── ☑ 查看数据模型
  ├── ☐ 管理数据模型
  └── ☐ 发布数据模型

🔍 查询分析 (3/3)                  [☑]
  ├── ☑ 执行数据查询
  ├── ☑ 管理查询任务
  └── ☑ 查看查询历史

⏰ 任务调度 (1/3)                  [◐]
  ├── ☑ 查看任务调度
  ├── ☐ 管理任务调度
  └── ☐ 监控任务执行

🛡️ 数据质量 (2/3)                 [◐]
  ├── ☑ 查看数据质量报告
  ├── ☑ 管理数据质量规则
  └── ☐ 配置质量监控

⚙️ 系统管理 (3/6)                 [◐]
  ├── ☑ 查看用户行为日志
  ├── ☑ 管理系统配置
  ├── ☑ 查看系统监控
  ├── ☐ 管理平台用户
  ├── ☐ 管理平台角色
  └── ☐ 管理平台项目
```

**交互说明：**
- **点击模块标题**: 展开/折叠子权限列表
- **勾选模块复选框**: 快速选择该模块下的所有权限
- **实时状态显示**: 显示已选择权限数量 (如: 工作台 2/3)
- **半选状态**: 当模块部分权限被选中时，复选框显示半透明状态

#### 截图说明
**截图1: 角色管理主界面**
- 显示角色列表，包含角色ID、名称、类型（平台级/项目级）、描述、权限数量
- 角色类型用不同颜色的徽章区分
- 核心角色的删除按钮为禁用状态

**截图2: 新增/编辑角色模态框**
- 包含角色基本信息表单
- 新版树形权限分配界面
- 用户友好的操作提示

### 2. 用户管理 (user_management.html) ⭐ 集成平台权限分配

#### 功能描述  
统一管理用户基本信息和平台级权限分配，简化操作流程。

#### 核心特性
- **🎯 一站式管理**: 用户信息和平台权限分配在同一页面完成
- **🔒 强制平台角色**: 所有用户必须分配平台角色，新用户默认为"普通用户"
- **🎨 角色视觉标识**: 不同平台角色使用不同颜色的徽章显示
- **⏰ 变更记录**: 角色变更时自动记录分配时间
- **🔗 项目关联显示**: 显示用户所属的项目信息

#### 平台角色视觉标识
- **🔴 平台管理员**: 粉红色徽章 (#FED7E2)
- **🟢 平台运维**: 绿色徽章 (#D6F5D6)  
- **🔵 平台审计**: 蓝色徽章 (#BEE3F8)
- **🟡 普通用户**: 青色徽章 (#E6FFFA)

#### 截图说明
**截图3: 用户管理主界面**
- 用户列表显示用户ID、用户名、邮箱、状态、平台角色（带颜色徽章）、所属项目、创建时间
- 平台角色用醒目的颜色徽章区分

**截图4: 新增/编辑用户模态框**
- 用户基本信息表单
- 平台角色下拉选择（默认为"普通用户"）
- 表单验证确保平台角色为必填

### 3. 项目用户分配 (project_user_management.html)

#### 功能描述
为特定项目分配用户和项目级角色，支持项目维度的用户权限管理。

#### 核心特性
- **📂 项目维度管理**: 按项目组织用户分配
- **🎯 项目角色专用**: 只显示项目级角色选项
- **🚫 重复检测**: 防止同一用户在同一项目中重复分配
- **✏️ 灵活编辑**: 支持编辑用户的项目角色

#### 截图说明
**截图5: 项目用户分配界面**
- 项目选择下拉框
- 当前项目的用户分配列表
- 添加用户到项目的操作按钮

**截图6: 用户分配模态框**
- 用户选择（已排除当前项目中的用户）
- 项目角色选择（只显示项目级角色）

### 4. 项目统筹 (project_management.html) ⭐ 数据资源管理

#### 功能描述
企业级项目管理模块，支持项目全生命周期管理和数据资源分配，特别针对保险行业业务场景进行了深度优化。

#### 核心特性
- **📊 项目全景管理**: 项目基本信息、管理员分配、数据资源配置统一管理
- **🎨 数据资源可视化**: 创新的色卡展示方式，直观显示项目数据资源构成
- **🏢 行业数据适配**: 基于真实保险业务系统的数据资源配置
- **🔍 智能筛选系统**: 多维度筛选，快速定位目标数据资源
- **💡 交互式详情**: 点击色卡弹窗查看完整资源清单

#### 数据资源管理体系

**双Tab数据资源架构：**

```
数据资源管理
├── 📡 数据源连接资源
│   ├── 🏢 业务系统数据源 (18个真实保险系统)
│   │   ├── 精算数据平台
│   │   ├── 反洗钱系统(AML_RISK/AML_IDENTIFY)  
│   │   ├── 核心业务系统(piccprod/claim_prod)
│   │   ├── CRM系统
│   │   ├── 保监会报送系统
│   │   └── 其他业务系统...
│   └── 📁 SFTP数据传输 (10个传输路径)
│       ├── /sftp/picc/finance/daily_reports
│       ├── /sftp/picc/regulatory/cbirc_reports
│       ├── /sftp/partner/banks/transaction_data
│       └── 其他SFTP路径...
└── 🏗️ 数据湖库资源  
    └── 🐘 Hive资源（数据湖） (10个数据层)
        ├── hive/hl_mis_ods (MIS操作数据存储层)
        ├── hive/hl_crm_dwd (CRM数据仓库详细层)
        ├── hive/hl_finance_dws (财务数据服务层)
        └── 其他数据层...
```

#### 资源展示创新设计

**色卡可视化系统：**
- **🔵 数据源色卡（蓝色）**: 显示"数据源X个"，包含业务系统和SFTP资源
- **🟢 数据湖色卡（绿色）**: 显示"数据湖X个"，包含所有Hive数据层资源
- **💬 交互式详情**: 点击色卡弹出浮窗，展示完整资源名称和归属公司
- **🎯 精准统计**: 实时统计各类型资源数量，便于项目资源评估

#### 智能筛选系统

**统一筛选界面：**
```
筛选器配置
├── 📋 数据源连接资源筛选
│   ├── 🏢 归属公司 (人保寿险、人保集团、合作银行等)
│   └── 📝 数据源名称 (模糊搜索)
└── 📋 数据湖库资源筛选  
    ├── 🏢 归属公司 (人保寿险、人保集团)
    └── 📝 数据资源名称 (模糊搜索)
```

**筛选器特性：**
- **🎯 位置统一**: 两个Tab筛选器位置层级完全一致
- **🔍 实时筛选**: 输入即时生效，支持模糊匹配
- **🧹 一键清除**: 快速重置所有筛选条件
- **📱 响应式设计**: 适配不同屏幕尺寸

#### 真实业务场景适配

**保险行业系统集成：**
- **核心业务**: 精算平台、核心业务系统、理赔系统
- **合规监管**: 反洗钱系统、保监会报送系统  
- **客户服务**: CRM系统、电话中心、ECIF系统
- **内部管理**: 人保E家、财务核算、审计系统
- **外部协作**: 银行对接、再保险、气象数据等

**数据传输通道：**
- **内部传输**: 人保集团内部系统间数据流转
- **监管报送**: 银保监会等监管机构数据上报
- **外部合作**: 银行、再保险公司数据交换
- **第三方服务**: 气象、信用评级、税务等外部数据

#### 截图说明
**截图8: 项目统筹主界面**
- 项目列表展示，突出数据资源色卡显示
- 蓝色和绿色色卡的对比效果
- 项目管理员信息和操作按钮

**截图9: 数据资源管理弹窗（数据源连接资源Tab）**
- 业务系统数据源列表（真实保险系统）
- SFTP数据传输路径展示
- 归属公司和数据源名称筛选器

**截图10: 数据资源管理弹窗（数据湖库资源Tab）**
- Hive数据层资源列表
- 公司归属标签（人保寿险/人保集团）
- 数据资源名称筛选功能

**截图11: 资源详情浮窗**
- 点击色卡后的浮窗效果
- 完整资源名称和归属公司信息
- 美观的悬浮窗设计

### 5. 权限体系测试 (permission_test.html)

#### 功能描述
可视化展示双权限体系的配置情况，便于系统验证和问题排查。

#### 核心特性
- **📊 分类展示**: 分别展示平台级和项目级角色
- **👥 用户权限概览**: 显示每个用户的平台角色和权限
- **🏗️ 项目分配情况**: 展示各项目的用户分配详情
- **🎨 视觉化展示**: 使用颜色徽章和图标增强可读性

#### 截图说明
**截图7: 权限体系测试页面**
- 平台级角色展示区域
- 项目级角色展示区域  
- 用户权限分配情况
- 项目用户分配情况

## 📱 页面结构

### 主页面 (index.html)
```
统一数据开发平台
├── 🏠 首页
├── ⚙️ 平台管理 (默认展开)
│   ├── 📊 项目统筹 (★ 数据资源管理核心)
│   ├── 🛡️ 角色管理
│   ├── 👥 用户管理 (★ 集成平台权限分配)
│   ├── 📋 菜单管理
│   └── 🧪 权限体系测试
├── 📊 项目管理 (默认折叠)
│   └── 👥 项目用户分配
├── 🔄 数据交换 (占位)
└── 📈 数据分析 (占位)
```

## 🎯 用户使用流程

### 平台权限分配流程（简化版）
```
1. 进入"用户管理"页面
2. 新增用户或编辑现有用户
3. 在表单中选择平台角色（新用户默认为"普通用户"）
4. 保存后系统自动记录分配时间
```

### 项目权限分配流程
```
1. 进入"项目用户分配"页面
2. 选择目标项目
3. 点击"添加用户到项目"
4. 选择用户和项目角色
5. 保存分配关系
```

### 角色权限配置流程
```
1. 进入"角色管理"页面
2. 新增角色或编辑现有角色
3. 使用树形权限分配界面配置权限：
   - 点击模块名展开/折叠
   - 勾选模块复选框批量选择
   - 单独勾选具体权限
4. 保存角色配置
```

## 🔧 技术实现要点

### 数据结构设计

#### 角色数据结构
```javascript
{
  id: 'role_platform_admin',
  name: '平台管理员',
  description: '拥有所有平台管理权限',
  type: 'platform', // 'platform' 或 'project'
  permissions: ['权限1', '权限2', ...],
  isCore: true // 核心角色不可删除
}
```

#### 用户数据结构
```javascript
{
  id: 'user_001',
  username: '张伟',
  email: 'zhang.wei@company.com',
  status: 'active',
  platformRole: 'role_platform_admin', // 必填
  platformRoleAssignedAt: '2023-01-01T10:00:00Z',
  createdAt: '2023-01-01T10:00:00Z'
}
```

#### 项目用户分配数据结构
```javascript
{
  id: 'assign_001',
  projectId: 'proj_001',
  userId: 'user_001',
  roleId: 'role_project_manager',
  assignedAt: '2023-01-01T10:00:00Z'
}
```

#### 项目数据结构（含数据资源）
```javascript
{
  id: 'proj_001',
  name: '寿险精算数据平台',
  description: '整合寿险精算数据，构建精算模型',
  admin: 'user_001',
  resources: ['ds_001', 'hive_001', 'ext_001'], // 数据资源ID数组
  createdAt: '2023-01-01T10:00:00Z'
}
```

#### 数据资源数据结构
```javascript
// 业务数据源
{
  id: 'ds_001',
  name: '精算数据平台',
  description: '人保寿险精算数据分析与管理平台',
  type: 'oracle',
  company: '人保寿险',
  status: 'active'
}

// SFTP数据传输
{
  id: 'ext_001', 
  name: '/sftp/picc/finance/daily_reports',
  description: '财务日报数据传输目录',
  type: 'sftp',
  company: '人保集团',
  status: 'active'
}

// Hive数据湖资源
{
  id: 'hive_001',
  name: 'hive/hl_mis_ods', 
  description: 'MIS操作数据存储层',
  type: 'hive',
  company: '人保寿险',
  status: 'active'
}
```

### 权限分配树形结构
```javascript
const PERMISSIONS_STRUCTURE = {
  '工作台': {
    icon: 'fas fa-tachometer-alt',
    permissions: ['查看数据看板', '管理数据看板', '导出数据看板']
  },
  '数据管理': {
    icon: 'fas fa-database', 
    permissions: ['查看数据源', '管理数据源', '配置数据连接', ...]
  },
  // ... 其他模块
};
```

## 🎨 UI/UX 设计规范

### 色彩体系
- **主色调**: Tech Blue (#3182CE)
- **成功色**: Green (#38A169)
- **警告色**: Orange (#ED8936)
- **错误色**: Red (#E53E3E)
- **背景色**: Light Gray (#EDF2F7)

### 角色徽章色彩
- **平台管理员**: Pink (#FED7E2, #97266D)
- **平台运维**: Green (#D6F5D6, #22543D)
- **平台审计**: Blue (#BEE3F8, #2A4365)
- **普通用户**: Teal (#E6FFFA, #234E52)

### 交互反馈
- **悬停效果**: 淡蓝色背景 (#EBF8FF)
- **选中状态**: 深蓝色背景 (#3182CE)
- **禁用状态**: 灰色 (#A0AEC0)

## 📸 截图指南

### 必要截图列表

1. **角色管理主界面**
   - 展示角色列表和角色类型徽章
   - 突出显示核心角色的保护机制

2. **角色权限配置界面（重点）**
   - 完整展示新的树形权限分配界面
   - 显示模块展开/折叠状态
   - 展示批量选择和状态计数功能

3. **用户管理界面（重点）**
   - 展示用户列表和平台角色徽章
   - 显示项目关联信息

4. **用户编辑界面**
   - 展示平台角色选择器
   - 显示默认角色设置

5. **项目统筹主界面（重点）**
   - 展示项目列表和创新的色卡数据资源显示
   - 突出蓝色（数据源）和绿色（数据湖）色卡对比
   - 显示项目管理员和操作按钮

6. **数据资源管理弹窗（重点）**
   - 数据源连接资源Tab：真实保险业务系统展示
   - 数据湖库资源Tab：Hive数据层展示
   - 筛选器功能演示

7. **资源详情交互（重点）**
   - 点击色卡弹出的浮窗效果
   - 完整资源列表和归属公司信息
   - 交互式用户体验展示

8. **项目用户分配界面**
   - 展示项目选择和用户分配列表
   - 显示项目角色分配流程

9. **权限体系测试界面**
   - 展示双权限体系的整体架构
   - 显示用户权限分配全貌

### 截图技巧
- **突出重点**: 使用红框标注关键功能点
- **完整展示**: 确保界面完整，包含所有重要元素
- **真实数据**: 使用有意义的测试数据，避免空白状态
- **状态展示**: 截取不同操作状态的界面

## 🚀 产品优势

### 1. 架构优势
- **清晰分离**: 平台权限与项目权限完全分离，职责明确
- **灵活组合**: 用户可同时拥有平台角色和多个项目角色
- **安全隔离**: 不同层级权限互不干扰，提升安全性

### 2. 管理优势  
- **操作简化**: 平台权限直接在用户管理中配置
- **批量操作**: 树形权限分配支持模块级批量选择
- **状态清晰**: 实时显示权限分配状态和统计信息

### 3. 用户体验优势
- **界面友好**: 直观的树形结构和颜色区分
- **操作高效**: 减少页面跳转，提升操作效率
- **反馈及时**: 实时状态更新和操作反馈
- **可视化创新**: 色卡展示数据资源，直观高效
- **交互式详情**: 点击查看完整信息，层次清晰

### 4. 扩展性优势
- **易于扩展**: 支持自定义角色和权限的灵活添加
- **模块化设计**: 可独立扩展功能模块
- **标准化**: 统一的数据结构和交互规范

## 📅 更新记录

### v2.0 (当前版本)
- ✅ 实现双权限体系架构
- ✅ 新增4个标准化平台角色
- ✅ 重设计树形权限分配界面
- ✅ 集成平台权限分配到用户管理
- ✅ 完善项目用户分配功能
- ✅ 添加权限体系测试页面
- ✅ **项目统筹模块重大升级**：
  - 🎨 创新色卡数据资源可视化展示
  - 🏢 集成真实保险业务系统数据（18个系统）
  - 📁 支持SFTP数据传输路径管理（10个路径）
  - 🐘 Hive数据湖资源管理（10个数据层）
  - 🔍 双Tab智能筛选系统
  - 💬 交互式资源详情浮窗

### v1.0 (基础版本)
- ✅ 基础用户管理功能
- ✅ 简单角色管理功能
- ✅ 基础项目管理功能

---

**文档版本**: v2.0  
**最后更新**: 2024年12月  
**维护团队**: 数据平台开发团队 